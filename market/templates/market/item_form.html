{% extends "market_base/base_with_navbar.html" %}
{% comment %} Use the shared base layout with navbar for the item create/edit page {% endcomment %}

{% load static %}
{% load widget_tweaks %}
{% load market_extras %}

+{% comment %} Page title: show item title on edit, or "Create" on new item {% endcomment %}
{% block title %}
  {% if postitem %}
    {{ postitem.item_title }}  
  {% else %}
    Create 
  {% endif %} | Podo-Market
{% endblock title %}

{% comment %} Main content {% endcomment %}
{% block content %}

{% comment %} Item create/update form: POST with file upload and server-side validation only (novalidate) {% endcomment %}
<form method="post" autocomplete="off" enctype="multipart/form-data" novalidate
      class="grid grid-cols-2 w-full max-w-[880px] mx-auto mt-[90px] mb-[250px] gap-x-[43px] gap-y-[27px]">

  {% csrf_token %}

  {% comment %} Item title input row {% endcomment %}
  <div class="col-span-2">

    {% comment %} Item title field with custom styling and placeholder {% endcomment %}
    {{ form.item_title|add_class:"podo-input"|attr:"placeholder:Item Title"|add_error_class:"error" }}

    {% comment %} Validation errors for item title {% endcomment %}
    {% for error in form.item_title.errors %}
      <div class="text-input-error-fg block w-full text-right text-[14px] leading-[1.7] mt-1 pr-4">
        {{ error }}
      </div>
    {% endfor %}
  </div>


  {# Row containing sold toggle, price field and condition radio buttons #}
  <div class="col-span-2">

    <div class="flex items-center gap-6 w-full">

      {# Optional "sold" toggle: only rendered when is_sold field exists (update form) #}
      {% if form.is_sold %}
        <div class="flex items-center">
          <label class="sold-toggle-wrapper">

            {% comment %} Hide the real checkbox visually; it only holds the state {% endcomment %}
            {{ form.is_sold|add_class:"sold-toggle-input" }}

            {% comment %} Colored track (green/gray) with the white capsule that slides left/right {% endcomment %}
            <span class="sold-toggle-track">
              <span class="sold-toggle-thumb">
                <span class="sold-toggle-text sold-toggle-text-sale">SALE</span>
                <span class="sold-toggle-text sold-toggle-text-sold">SOLD</span>
              </span>
            </span>

          </label>
        </div>
      {% endif %}

      {# Item price input (center) #}
      <div class="flex-1">
        {{ form.item_price|add_class:"podo-input no-spin"|attr:"placeholder:Item Price"|add_error_class:"error" }}
      </div>

      {# Item condition radio buttons (right side) #}
      <div class="flex flex-nowrap justify-end items-center gap-3">
        {% for value, label in form.item_condition.field.choices %}
          <label class="cursor-pointer shrink-0">
            <input
              type="radio"
              name="{{ form.item_condition.html_name }}"
              value="{{ value }}"
              class="sr-only peer"
              {% if form.item_condition.value == value|stringformat:"s" %}checked{% endif %}>
            <span class="podo-chip text-[15px] text-chip-border font-semibold px-3 py-1.5 leading-5
              peer-checked:text-chip-primary-fg
              peer-checked:bg-chip-primary-bg
              peer-checked:border-chip-primary-border
              {% if form.item_condition.errors %}podo-select-error{% endif %}">
              {{ label }}
            </span>
          </label>
        {% endfor %}
      </div>

    </div>

    {% comment %} Validation errors for price (left) and condition (right) under the row {% endcomment %}
    <div class="mt-1 grid grid-cols-2 gap-x-6">
      <div>
        {% for error in form.item_price.errors %}
          <div class="text-input-error-fg block w-full text-right text-[14px] leading-[1.7] mt-1 pr-4">
            {{ error }}
          </div>
        {% endfor %}
      </div>

      <div>
        {% for error in form.item_condition.errors %}
          <div class="text-input-error-fg block w-full text-right text-[14px] leading-[1.7] mt-1 pr-4">
            {{ error }}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>


  {% comment %} Item detail (description) textarea row {% endcomment %}
  <div class="col-span-2">

    {% comment %} Description field with custom styling and placeholder {% endcomment %}
    {{ form.item_detail|add_class:"podo-input"|attr:"placeholder:Item Details"|add_error_class:"error" }}

    {% comment %} Validation errors for item detail {% endcomment %}
    {% for error in form.item_detail.errors %}
      <div class="text-input-error-fg block w-full text-right text-[14px] leading-[1.7] mt-1 pr-4">
        {{ error }}
      </div>
    {% endfor %}
  </div>


  {% comment %} Image upload section: main image + optional second and third images {% endcomment %}
  <div class="col-span-2">
    <div class="grid grid-cols-3 gap-3">

      {% comment %} First (main) image upload {% endcomment %}
      <div>

        {% comment %} File input (hidden by widget); label below acts as the visible button {% endcomment %}
        {{ form.item_image1 }}
        <label for="{{ form.item_image1.id_for_label }}"
              class="podo-input flex flex-col items-center justify-center cursor-pointer {% if form.item_image1.errors %} error{% endif %}">
          
          {% comment %} Upload icon for main image {% endcomment %}
          <img src="{% static 'market/icons/upload.svg' %}"
              alt="Upload image 1"
              class="w-6 h-6">

          {% comment %} Dynamic filename text for selected or existing main image {% endcomment %}
          <span id="file-name-1"
                class="text-input-placeholder text-[14px] truncate max-w-full text-center mt-2 
                {% if form.instance.item_image1 %}{% else %}hidden{% endif %}">
            {% if form.instance.item_image1 %}
            {{ form.instance.item_image1.name|filename_filter }}
            {% endif %}
          </span>

          {% comment %} Existing main image preview (edit mode only) {% endcomment %}
          {% if form.instance.item_image1 %}
            <img src="{{ form.instance.item_image1.url }}" alt="First-image" class="w-full h-40 object-cover rounded-lg mt-3">
          {% endif %}

        </label>

        {% comment %} Validation errors for main image {% endcomment %}
        {% for error in form.item_image1.errors %}
          <div class="text-input-error-fg block w-full text-right text-[14px] leading-[1.7] mt-1 pr-3">
            {{ error }}
          </div>
        {% endfor %}
      </div>


      {% comment %} Second (optional) image upload {% endcomment %}
      <div>

        {% comment %} File input (hidden by widget); label below acts as the visible button {% endcomment %}
        {{ form.item_image2 }}
        <label for="{{ form.item_image2.id_for_label }}"
              class="podo-input flex flex-col items-center justify-center cursor-pointer {% if form.item_image2.errors %} error{% endif %}">
          
          {% comment %} Upload icon for second image {% endcomment %}
          <img src="{% static 'market/icons/upload.svg' %}"
              alt="Upload image 2"
              class="w-6 h-6">

          {% comment %} Dynamic filename text for selected or existing second image {% endcomment %}
          <span id="file-name-2"
                class="text-input-placeholder text-[14px] truncate max-w-full text-center mt-2 
                {% if form.instance.item_image2 %}{% else %}hidden{% endif %}">
            {% if form.instance.item_image2 %}
              {{ form.instance.item_image2.name|filename_filter }}
            {% endif %}
          </span>

          {% comment %} Existing second image preview (edit mode only) {% endcomment %}
          {% if form.instance.item_image2 %}
            <img src="{{ form.instance.item_image2.url }}" alt="Second-image" class="w-full h-40 object-cover rounded-lg mt-3">
          {% endif %}

        </label>
        
        {% comment %} Validation errors for second image {% endcomment %}
        {% for error in form.item_image2.errors %}
          <div class="text-input-error-fg block w-full text-right text-[14px] leading-[1.7] mt-1 pr-4">
            {{ error }}
          </div>
        {% endfor %}
      </div>


      {% comment %} Third (optional) image upload {% endcomment %}
      <div>

        {% comment %} File input (hidden by widget); label below acts as the visible button {% endcomment %}
        {{ form.item_image3 }}
        <label for="{{ form.item_image3.id_for_label }}"
              class="podo-input flex flex-col items-center justify-center cursor-pointer {% if form.item_image3.errors %} error{% endif %}">
          
          {% comment %} Upload icon for third image {% endcomment %}
          <img src="{% static 'market/icons/upload.svg' %}"
              alt="Upload image 3"
              class="w-6 h-6">

          {% comment %} Dynamic filename text for selected or existing third image {% endcomment %}
          <span id="file-name-3"
                class="text-input-placeholder text-[14px] truncate max-w-full text-center mt-2 
                {% if form.instance.item_image3 %}{% else %}hidden{% endif %}">
            {% if form.instance.item_image3 %}
              {{ form.instance.item_image3.name|filename_filter }}
            {% endif %}
          </span>

          {% comment %} Existing third image preview (edit mode only) {% endcomment %}
          {% if form.instance.item_image3 %}
            <img src="{{ form.instance.item_image3.url }}" alt="Third-image" class="w-full h-40 object-cover rounded-lg mt-3">
          {% endif %}

        </label>

        {% comment %} Validation errors for third image {% endcomment %}
        {% for error in form.item_image3.errors %}
          <div class="text-input-error-fg block w-full text-right text-[14px] leading-[1.7] mt-1 pr-4">
            {{ error }}
          </div>
        {% endfor %}
      </div>

    </div>
  </div>

  {% comment %} Form action buttons: Cancel (back to list) and Save (submit form) {% endcomment %}
  <div class="col-span-2 flex w-full max-w-[600px] mx-auto mt-4">

    {% comment %} Cancel button: go back to item detail on edit, or home (item list) on create {% endcomment %}
    <a href="{% if postitem %}{% url 'item-detail' postitem.id %}{% else %}{% url 'home' %}{% endif %}" 
      class="podo-button large secondary grow mr-[15px] text-center">
      Cancel
    </a>

    {% comment %} Save button: submit the form and create a new item {% endcomment %}
    <button type="submit" class="podo-button large primary grow-6 text-center">
      Save
    </button>
  </div>

</form>

{% endblock content %}
