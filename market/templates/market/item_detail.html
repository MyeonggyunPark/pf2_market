{% extends "market_base/base_with_navbar.html" %}
{% comment %} Use the shared base layout with navbar for the item detail page {% endcomment %}

{% load static %}
{% load humanize %}
{% load market_extras %}

{% comment %} Page title: show item title followed by site name {% endcomment %}
{% block title %}{{ postitem.item_title }} | Podo-Market{% endblock title %}

{% comment %} Main content {% endcomment %}
{% block content %}

<div class="w-full max-w-[880px] mx-auto mt-[67px] mb-[120px]">

  {% comment %} Top bar: back link and (optional) Edit/Delete actions {% endcomment %}
  <div class="flex justify-between items-center text-[20px] mb-[23px] mx-[7px]">

    {% comment %} Link to navigate back to the item list (home page) {% endcomment %}
    <a href="{% url 'home' %}" class="hover:text-link font-semibold">
      <span class="text-[28px]">Â«</span> 
      Go to Home
    </a>

    {% comment %} Show Edit/Delete buttons only when the logged-in user is the author {% endcomment %}
    {% if postitem.item_author == user %}
    <div class="flex space-x-2">
      <a class="podo-button small negative" href="{% url 'item-delete' postitem.id %}">Delete</a>
      <a class="podo-button small secondary" href="{% url 'item-update' postitem.id %}">Edit</a>
    </div>
    {% endif %}
  </div>

  {% comment %} Main item image (first image is required) {% endcomment %}
  <img class="w-full h-auto max-h-[645px] object-cover rounded-[11px]" 
      src="{{ postitem.item_image1.url }}" alt="item-image-1">

  {% comment %} Optional second image: only render if item_image2 exists {% endcomment %}
  {% if postitem.item_image2 %}
  <img class="w-full h-auto max-h-[645px] object-cover rounded-[11px] mt-[15px]"
      src="{{ postitem.item_image2.url }}" alt="item-image-2">
  {% endif %}

  {% comment %} Optional third image: only render if item_image3 exists {% endcomment %}
  {% if postitem.item_image3 %}
  <img class="w-full h-auto max-h-[645px] object-cover rounded-[11px] mt-[15px]"
      src="{{ postitem.item_image3.url }}" alt="item-image-3">
  {% endif %}

  {% comment %} Item header section: title, price, condition, and creation date {% endcomment %}
  <div class="mt-[30px] mb-[42px] mx-[15px]">

    {% comment %} Item title {% endcomment %}
    <h1 class="text-[22px] font-normal mb-[15px] truncate">
      {{ postitem.item_title }}
    </h1>

    {% comment %} Price, condition, and creation date {% endcomment %}
    <div class="flex items-center">

      {% comment %} Item price {% endcomment %}
      <span class="text-[25px] font-bold mr-[15px] 
          {% if postitem.is_sold %}line-through text-post-sold{% endif %}">
        &euro;&nbsp;{{ postitem.item_price|intcomma }}
      </span>

      {% comment %} Item condition {% endcomment %}
      <span class="podo-chip font-bold text-chip-primary-fg bg-chip-primary-bg border-chip-primary-border
          {% if postitem.is_sold %} hidden {% endif %}">
        {{ postitem.get_item_condition_display }}
      </span>

      {% comment %} Sold status text shown when the item is marked as sold {% endcomment %}
      {% if postitem.is_sold %}
        <span class="podo-chip font-bold text-post-sold border-3 border-post-sold">
        {{ postitem.get_item_condition_display }}
        </span>

        <span class="ml-[15px] podo-chip font-bold text-chip-primary-fg bg-chip-primary-bg border-chip-primary-border">
          Sold
        </span>
      {% endif %}

      {% comment %} Creation date of the item {% endcomment %}
      <span class="ml-auto text-[15px] text-post-detail-date">
        {{ postitem.dt_created|date:"d.m.Y" }}
      </span>

    </div>
    
  </div>

  {% comment %} Seller information box: profile image, nickname, rating, and location {% endcomment %}
  <a href="#" class="no-underline">
    <div class="podo-box gray-background flex justify-center items-center px-5 mx-[15px] py-[25px] rounded-[27px]">

      <div class="flex justify-around w-full">

        {% comment %} Seller profile image {% endcomment %}
        <div class="flex">
          <img class="w-[79px] h-[79px] mr-[23px] rounded-full bg-profile-pic-placeholder bg-cover bg-center "
            src="{{ postitem.item_author.profile_pic.url|default:'' }}">
          </img>
    
          {% comment %} Seller nickname {% endcomment %}      
          <div class="text-[20px] font-bold flex items-center">
            {{ postitem.item_author.nickname }}
          </div>
        </div>

        {% comment %}
          Seller rating: render a number of filled and empty stars based on
          the author's seller_rating value using the filled_stars/empty_stars filters
        {% endcomment %}
        <p class="flex items-center">
          {% for _ in postitem.item_author.seller_rating|filled_stars %}
          <i class="fa-solid fa-star text-xl text-button-darkpurple-bg"></i>
          {% endfor %}
          {% for _ in postitem.item_author.seller_rating|empty_stars %}
          <i class="fa-solid fa-star text-xl text-site-footer-text"></i>
          {% endfor %}
        </p>
        
        {% comment %} Seller location: address and city {% endcomment %}
        <ul class="podo-links">
          <li>{{ postitem.item_author.address }}</li>
          <li class="divider"></li>
          <li>{{ postitem.item_author.city }}</li>
        </ul>

      </div>
    </div>
  </a>

  {% comment %} Item description {% endcomment %}
  <p class="text-[17px] leading-[30px] mx-[15px] mt-9 px-9 mb-[300px]">
    {{ postitem.item_detail|linebreaksbr }}
  </p>

</div>

{% endblock content %}
