{% extends "market_base/base_with_header.html" %}
{% comment %} Use the simple header base layout for the profile edit page {% endcomment %}

{% load static %}
{% load widget_tweaks %}

{% comment %} Page title shown in the browser tab {% endcomment %}
{% block title %}Edit Profile | Podo-Market{% endblock title %}

{% comment %} Main content {% endcomment %}
{% block content %}

{% comment %} Centered container for the profile edit form {% endcomment %}
<div class="w-full max-w-[654px] mx-auto my-[145px]">

  {% comment %} Profile edit form (POST + file upload, server-side validation only) {% endcomment %}
  <form method="post" autocomplete="off" enctype="multipart/form-data" novalidate
      class="podo-box px-8 py-10 md:px-[107px] md:pt-[54px] md:pb-[76px]">

    {% csrf_token %}

    {% comment %} Profile picture: current avatar preview + upload control {% endcomment %}
    <div class="flex items-center justify-center mb-[35px]">
      <img src="{{ user.profile_pic.url|default:'' }}" alt="Profile picture"
        class="size-20 mr-[21px] rounded-full bg-profile-pic-placeholder bg-cover bg-center object-cover">
      <div class="flex-1 leading-loose overflow-hidden text-ellipsis whitespace-nowrap">
        {{ form.profile_pic }}

        {% comment %} Styled label that opens the hidden profile_pic file input {% endcomment %}
        <label for="{{ form.profile_pic.id_for_label }}"
            class="podo-input flex flex-col items-center justify-center cursor-pointer">
          <img class="size-6" src="{% static 'market/icons/upload.svg' %}" alt="Upload profile image">
          <span id="profile-file-name"
            class="text-input-placeholder text-[14px] truncate max-w-full text-center mt-2 hidden"></span>
        </label>

        {% comment %} Validation errors for profile picture field {% endcomment %}
        {% for error in form.profile_pic.errors %}
          <div class="text-input-error-fg block w-full text-right text-[14px] leading-[1.7] mt-1 pr-4">
            {{ error }}
          </div>
        {% endfor %}
      </div>
    </div>

    {% comment %} Nickname input + error messages {% endcomment %}
    <div class="mb-[25px]">
      {{ form.nickname|add_class:"podo-input"|attr:"placeholder:Nickname"|add_error_class:"error" }}
      {% for error in form.nickname.errors %}
        <div class="text-input-error-fg block w-full text-right text-[14px] leading-[1.7] pr-4">
          {{ error }}
        </div>
      {% endfor %}
    </div>

    {% comment %} Address input + error messages {% endcomment %}
    <div class="mb-[25px]">
      {{ form.address|add_class:"podo-input"|attr:"placeholder:Address"|add_error_class:"error" }}
      {% for error in form.address.errors %}
        <div class="text-input-error-fg block w-full text-right text-[14px] leading-[1.7] pr-4">
          {{ error }}
        </div>
      {% endfor %}
    </div>

    {% comment %} City and state input + error messages {% endcomment %}
    <div class="mb-[25px]">
      {{ form.city|add_class:"podo-input"|attr:"placeholder:City and State (ex. Essen, NRW)"|add_error_class:"error" }}
      {% for error in form.city.errors %}
        <div class="text-input-error-fg block w-full text-right text-[14px] leading-[1.7] pr-4">{{ error }}</div>
      {% endfor %}
    </div>

    {% comment %} Introduction textarea + error messages {% endcomment %}
    <div class="mb-[25px]">
      {{ form.intro|add_class:"podo-input"|attr:"placeholder:Introduction"|add_error_class:"error" }}
      {% for error in form.intro.errors %}
        <div class="text-input-error-fg block w-full text-right text-[14px] leading-[1.7] pr-4">{{ error }}</div>
      {% endfor %}
    </div>

    {% comment %} Form actions: cancel (back to profile) and save changes {% endcomment %}
    <div class="flex">
      <a class="podo-button large secondary flex-1 mr-[15px] text-center" href="{% url 'profile' user.id %}">
        Cancel
      </a>
      <button class="podo-button large primary flex-5 ml-[15px]" type="submit">
        Save
      </button>
    </div>

  </form>
</div>

{% endblock content %}

